(this.webpackJsonptrees=this.webpackJsonptrees||[]).push([[0],{18:function(e,t,a){e.exports=a(29)},23:function(e,t,a){},24:function(e,t,a){},28:function(e,t){e.exports=function(){var e,t=this,a=[],n=50,i=100,r=0,l=0,s=0;function c(e,t,a,n){this.data=e,this.left=t,this.right=a,this.father=n,this.space=0,this.height=0,this.theta=0,this.index=-99,this.circle=new h}function h(){this.id=0,this.x=0,this.y=0}function o(){var e=this;this.index=0,this.assign=function(t){t.index=e.index,t.circle.id=e.index,e.index++}}this.tallestTreeScale=!1,this.useCladogram=!1,this.maxNameLength=0,this.circles=[],this.getMaxHeight=function(e,a){l=0;for(var n=0;n<e;n++){var i=t.getTreeHeight(a[n]);i>l&&(l=i)}},this.getTreeHeight=function(e){for(var t=e.replace(/(#\d.\d+)([eE](\+|-)?[0-9]+)?/g,""),a=0;"("===t[a];)a++;var n=(t=t.replace(/\(+/,"")).match(/((\+|-)?([0-9]+\.[0-9]*|\.[0-9]+)([eE](\+|-)?[0-9]+)?)|(\w+)|(\()|(\))|(\,)/g),i=0;i+=Number(n[1]);for(var r=0,l=2;l<n.length;l++)"("===n[l]?r++:")"===n[l]&&0===r&&a>1?(i+=Number(n[l+1]),a--):")"===n[l]&&r>0&&r--;return i},this.makeEdge=function(e,t,a,n){n.lineWidth=3,n.lineJoin="round",n.beginPath(),n.moveTo(e,t),n.lineTo(e,a),n.stroke()},this.printNames=function(e,a){for(var i=40+n,r=15+t.maxNameLength-12,l=0;l<e.length;l++)a.textAlign="start",a.textBaseline="middle",a.save(),a.translate(i,r),a.rotate(1.5*Math.PI),a.fillText(e[l],0,0),a.restore(),i+=n},this.postOrder=function(e,a,l){if(l){if(l){if(null===e)return;null!=e.left&&t.postOrder(e.left,a,!0),null!=e.right&&t.postOrder(e.right,a,!0),null===e.left&&null===e.right?(r+=n,e.space=r,t.printTheta(e.space+40,15+t.maxNameLength,e,a,!0),t.makeEdge(e.space+40,15+t.maxNameLength,e.height*i+15+t.maxNameLength,a)):(e.space=(e.left.space+e.right.space)/2,a.lineWidth=2,a.lineJoin="round",a.beginPath(),a.moveTo(e.left.space+40,e.right.height*i+15+t.maxNameLength),a.lineTo(e.right.space+40,e.right.height*i+15+t.maxNameLength),a.stroke(),null!=e.father?(t.printTheta(e.space+40,e.right.height*i+15+t.maxNameLength,e,a),t.makeEdge(e.space+40,e.right.height*i+15+t.maxNameLength,e.height*i+15+t.maxNameLength,a)):t.drawRootTheta(e,a,e.theta,!1))}}else{if(null===e)return;null!==e.left&&t.postOrder(e.left,a,!1),null!==e.right&&t.postOrder(e.right,a,!1),null==e.left&&null==e.right?(r+=n,e.space=r,t.printTheta(e.space+40,e.height*i+15+t.maxNameLength,e,a),t.makeEdge(e.space+40,e.height*i+15+t.maxNameLength,e.father.height*i+15+t.maxNameLength,a)):(e.space=(e.left.space+e.right.space)/2,a.lineWidth=2,a.lineJoin="round",a.beginPath(),a.moveTo(e.left.space+40,e.height*i+15+t.maxNameLength),a.lineTo(e.right.space+40,e.height*i+15+t.maxNameLength),a.stroke(),null!=e.father?(t.printTheta(e.space+40,e.height*i+15+t.maxNameLength,e,a),t.makeEdge(e.space+40,e.height*i+15+t.maxNameLength,e.father.height*i+15+t.maxNameLength,a)):t.drawRootTheta(e,a,e.theta,!0))}},this.drawOneTree=function(c,h,o,d,g,u,f){c<h.length&&(o?t.treeFromNewick(h[c],!1,g):t.treeFromNewick(h[c],!0,g),n=.9*(d.width-40)/a.length,r=0,i=o?f/e.height:u?f/l:f/e.left.height,o||(s=30/i,t.makeEdge(0,15+t.maxNameLength,15+t.maxNameLength+s*i,g),g.fillText(s.toPrecision(1),5,15+t.maxNameLength+s*i)),g.font="italic bold 16px serif",t.printNames(a,g),o?t.postOrder(e,g,!1):t.postOrder(e,g,!0))},this.treeFromNewick=function(n,i,r){var l=0;if(i){if(i){a=n.replace(/(#\d+\.\d+)|(\d+\.\d+)/g,"").replace(/e-\d+/g,"").replace(/:/g,"").match(/(?=\D)(\w+)/g),t.getMaxLenSN(a,r);for(var s=(n=n.replace(/e-\d+/g,"").replace(/:/g,"")).match(/((\+|-)?([0-9]+\.[0-9]*|\.[0-9]+)([eE](\+|-)?[0-9]+)?)|(\w+)|(\()|(\))|(\,)|([#]\d+\.\d+)/g),h=new c("root",null,null,null,null,null,null),o=e=h,d=0,g=0;g<s.length;g++)switch("("!==s[g]&&","!==s[g]||(h=new c("empty",null,null,null,null,null,null)),s[g]){case"(":o.left=h,h.father=o,o=h;break;case",":(o=o.father).right=h,h.father=o,o=h;break;case")":d=o.height,o=o.father;break;case";":break;default:o.order=l,null!=s[g].match(/(\+|-)?([0-9]+\.[0-9]*|\.[0-9]+)([eE](\+|-)?[0-9]+)?/)&&null==s[g].match(/([#]\d+\.\d+)/)?o.height=parseFloat(s[g])+d:s[g].match(/([#]\d+\.\d+)/)?o.theta=s[g]:(o.data=s[g],d=0)}}}else{var u=n.match(/(\,)/g).length;n=n.replace(/e-\d+/g,"").replace(/:/g,""),a=n.match(/(?=\D)(\w+)/g),t.getMaxLenSN(a,r);var f=n.match(/([A-Za-z]+)|(\()|(\))|(\,)|([#]\d+\.\d+)/g),m=new c("root",null,null,null);m.height=u;var p=e=m;p.height=0;for(var x=0;x<f.length;x++){switch("("!==f[x]&&","!==f[x]||(m=new c("empty",null,null,null)),f[x]){case"(":p.left=m,m.father=p,p=m;break;case",":(p=p.father).right=m,m.father=p,p=m;break;case")":(p=p.father).height=Math.max(p.right.height,p.left.height)+1;break;default:f[x].match(/([#]\d+\.\d+)/g)?(p.theta=f[x],p.order=l):(p.data=f[x],p.height=0)}l+=1}e.height=Math.max(p.right.height,p.left.height)+1}},this.getMaxLenSN=function(e,a){for(var n=0,i=0,r=0;r<e.length;r++)e[r].length>n&&(n=e[r].length,i=r),a.font="italic bold 16px serif",t.maxNameLength=a.measureText(e[i]).width},this.printTheta=function(e,t,a,n,i){if(a&&a.theta){n.textAlign="start",n.textBaseline="middle",n.save();var r=e-70,l=t+15;n.translate(r,l);var s=a.theta.replace(/[#]/,"");n.fillText(s,0,0),n.restore()}},this.drawRootTheta=function(e,a,n,r){if(n)if(r){var l=(e.left.space+e.right.space)/2+40,s=e.height*i+15+t.maxNameLength;a.save(),a.translate(l,s+10),n=n.replace(/[#]/,""),a.fillText(n,0,0),a.restore()}else{var c=(e.left.space+e.right.space)/2+40,h=e.right.height*i+15+t.maxNameLength;a.save(),a.translate(c,h+10),n=n.replace(/[#]/,""),a.fillText(n,0,0),a.restore()}else console.log("bad")},this.newSpeciesOrder=function(e){var t=[];return function e(t,a){if(null===t)return;var n=t;null!==n.left&&e(n.left,a);null!==n.right&&e(n.right,a);null===n.left&&null===n.right&&a.push(t.data)}(e,t),t},this.displayIndex=function(a,n){if(0===t.circles.length){if(e){var i=new o;!function e(t,a){if(null===t)return;null!==t.left&&null!==t.right&&a.assign(t);null!==t.left&&e(t.left,a);null!==t.right&&e(t.right,a)}(e,i),t.DrawIndex(e,a,n,t.maxNameLength)}}else e&&(t.circles=[],t.DrawIndex(e,a,n,t.maxNameLength))},this.DrawIndex=function(e,a,n,r){null!==e&&(null!==e.left&&null!==e.right&&(a?t.drawIndexToCanvas(e.space+40,e.right.height*i+15,r,e,n,a):t.drawIndexToCanvas(e.space+40,e.height*i+15,r,e,n,a)),null!==e.left&&t.DrawIndex(e.left,a,n,r),null!==e.right&&t.DrawIndex(e.right,a,n,r))},this.createCircle=function(e,a,n,i){t.circles.push({x:e,y:a,radius:n,id:i})},this.drawIndexToCanvas=function(e,a,n,r,l,s){if(null===r.father)if(s){var c=(r.left.space+r.right.space)/2+40,h=r.right.height*i+15+n;l.save(),l.beginPath(),t.createCircle(c,h,15,r.index),l.arc(c,h,15,0,2*Math.PI,!1),l.fillStyle="#4a4a4a",l.fill(),l.lineWidth=3,l.strokeStyle="#000000",l.stroke(),l.restore(),l.save(),l.translate(c-4,h),l.fillStyle="#ffffff",l.fillText(r.index,0,0),l.restore()}else{var o=(r.left.space+r.right.space)/2+40-50,d=r.height*i+15+n+10;l.save(),l.beginPath(),t.createCircle(o,d,15,r.index),l.arc(o,d,15,0,2*Math.PI,!1),l.fillStyle="#4a4a4a",l.fill(),l.lineWidth=3,l.strokeStyle="#000000",l.stroke(),l.restore(),l.save(),l.translate(o-4,d),l.fillStyle="#ffffff",l.fillText(r.index,0,0),l.restore()}else l.textAlign="start",l.textBaseline="middle",l.save(),l.beginPath(),t.createCircle(e,a+30,15,r.index),l.arc(e,a+30,15,0,2*Math.PI,!1),l.fillStyle="#4a4a4a",l.fill(),l.lineWidth=3,l.strokeStyle="#000000",l.stroke(),l.restore(),l.save(),l.translate(e-4,a+30),l.fillStyle="#ffffff",l.fillText(r.index,0,0),l.restore()},this.swapNodes=function(c,h,o,d,g,u){e&&(!function e(t,a){if(null!==t){if(t.index===a&&t.left&&t.right){var n=t.left;t.left=t.right,t.right=n}null!==t.left&&e(t.left,a),null!==t.right&&e(t.right,a)}}(e,c),n=.9*(o.width-40)/a.length,r=0,i=h?u/e.height:g?u/l:u/e.left.height,h||(s=30/i,t.makeEdge(0,15+t.maxNameLength,15+t.maxNameLength+s*i,d),d.fillText(s.toPrecision(1),5,15+t.maxNameLength+s*i)),d.font="italic bold 16px serif",t.printNames(t.newSpeciesOrder(e),d),h?t.postOrder(e,d,!1):t.postOrder(e,d,!0))},this.redrawCurrentTree=function(c,h,o,d,g){e&&(n=.9*(h.width-40)/a.length,r=0,i=c?g/e.height:d?g/l:g/e.left.height,c||(s=30/i,t.makeEdge(0,15+t.maxNameLength,15+t.maxNameLength+s*i,o),o.font="italic bold 16px serif",o.fillText(s.toPrecision(1),5,15+t.maxNameLength+s*i)),o.font="italic bold 16px serif",t.printNames(t.newSpeciesOrder(e),o),c?t.postOrder(e,o,!1):t.postOrder(e,o,!0))}}},29:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(12),l=a.n(r),s=(a(23),a(24),a(2)),c=a(3),h=a(5),o=a(4),d=a(1),g=a(6),u=a(7),f=a(8);function m(){var e=Object(u.a)(["\n  width: 20px;\n  height: 20px;\n  border-radius: 3px;\n  position: relative;\n  top: -3px;\n  opacity: 0.5;\n  background: #33ff99;\n  cursor: pointer;\n"]);return m=function(){return e},e}function p(){var e=Object(u.a)(["\n  position: relative;\n  border-radius: 3px;\n  background: #dddddd;\n  height: 15px;\n"]);return p=function(){return e},e}function x(){var e=Object(u.a)(["\n  display: flex;\n  justify-content: flex-end;\n"]);return x=function(){return e},e}var v=f.a.div(x()),w=f.a.div(p()),y=f.a.div(m()),N=function(e,t){return 100*e/t},C=function(e){return"calc(".concat(e,"% - 5px)")},b=function(e){var t=e.initial,a=e.max,n=e.onChange,r=N(t,a),l=i.a.useRef(),s=i.a.useRef(),c=i.a.useRef(),h=i.a.useRef(null),o=function(e){var t=e.clientX-h.current-l.current.getBoundingClientRect().left,i=l.current.offsetWidth-s.current.offsetWidth;t<0&&(t=0),t>i&&(t=i);var r=N(t,i),o=function(e,t){return t/100*e}(r,a);s.current.style.left=C(Math.round(r)),c.current.textContent=Math.round(o),n(o)},d=function e(){document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",o)};return i.a.createElement(i.a.Fragment,null,i.a.createElement(v,null,i.a.createElement("strong",{ref:c},t),"\xa0/\xa0",a),i.a.createElement(w,{ref:l},i.a.createElement(y,{style:{left:C(r)},ref:s,onMouseDown:function(e){h.current=e.clientX-s.current.getBoundingClientRect().left,document.addEventListener("mousemove",o),document.addEventListener("mouseup",d)}})))},L=a(16),k=a.n(L),T=a(28),E=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(h.a)(this,Object(o.a)(t).call(this,e))).IntersectWithCircle=function(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)<Math.pow(t.radius,2)},a.init=function(){null===a.state.treeVec[a.state.treeVec.length-2].match(";")&&a.treeVec.pop();var e=a.state.treeVec.length-2;a.utils.getMaxHeight(e,a.state.treeVec),a.utils.drawOneTree(a.currentTree,a.state.treeVec,a.state.Cladogram,a.canvas,a.ctx,a.state.RelScaling,.9*a.ctx.canvas.height-a.utils.maxNameLength)},a.onWindowResize=function(){a.ctx.canvas.width=window.innerWidth,a.ctx.canvas.height=.8*window.innerHeight,a.ctx.clearRect(0,0,a.ctx.canvas.width,a.ctx.canvas.height),a.utils.redrawCurrentTree(a.state.Cladogram,a.canvas,a.ctx,a.state.RelScaling,.9*a.ctx.canvas.height-a.utils.maxNameLength),a.DisplayIndex&&a.runDisplayIndex(a.state.Cladogram,a.state.RelScaling,a.ctx)},a.slideToNextTree=function(e){a.DisplayIndex=!1;var t=Math.round(e);a.currentTree=t,a.ctx.clearRect(0,0,a.ctx.canvas.width,a.ctx.canvas.height),a.utils.drawOneTree(t,a.state.treeVec,a.state.Cladogram,a.canvas,a.ctx,a.state.RelScaling,.9*a.ctx.canvas.height-a.utils.maxNameLength)},a.toggleIndexDisplay=function(){a.utils.circles=[],a.DisplayIndex=!a.DisplayIndex,a.ctx.clearRect(0,0,a.ctx.canvas.width,a.ctx.canvas.height),a.utils.redrawCurrentTree(a.state.Cladogram,a.canvas,a.ctx,a.state.RelScaling,.9*a.ctx.canvas.height-a.utils.maxNameLength),a.DisplayIndex&&a.runDisplayIndex(a.state.Cladogram,a.state.RelScaling,a.ctx)},a.runDisplayIndex=function(e,t,n){e?a.utils.displayIndex(!1,n):a.utils.displayIndex(!0,n)},a.saveAsPDF=function(){a.DisplayIndex&&a.toggleIndexDisplay();var e=a.canvas.toDataURL(),t=new k.a;t.addImage(e,"JPEG",10,-145,300,150,null,null,-90),t.save("download.pdf")},a.state={receivedData:a.props.received,treeVec:a.props.trees,tallestTreeScale:!1,useCladogram:!1,maxNameLength:0,RelScaling:a.props.relscal,Cladogram:a.props.clado,updateMe:!0},a.currentTree=0,a.utils=new T,a.DisplayIndex=!1,a}return Object(g.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.canvas=this.refs.canvas,this.ctx=this.canvas.getContext("2d"),this.ctx.save(),this.ctx.font="italic 25px serif",this.ctx.fillText("Please select input file",(this.canvas.width-350)/2,this.canvas.height/2),this.ctx.restore(),window.addEventListener("resize",this.onWindowResize,!1),this.canvas.addEventListener("click",(function(t){if(e.utils.circles.length>0){var a={x:t.clientX-e.ctx.canvas.offsetLeft,y:t.clientY-e.ctx.canvas.offsetTop};e.utils.circles.forEach((function(t){e.IntersectWithCircle(a,t)&&(e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),e.utils.swapNodes(t.id,e.state.Cladogram,e.canvas,e.ctx,e.state.RelScaling,.9*e.ctx.canvas.height-e.utils.maxNameLength),e.DisplayIndex&&e.runDisplayIndex(e.state.Cladogram,e.state.RelScaling,e.ctx))}))}})),this.utils.tallestTreeScale=this.state.RelScaling,this.utils.useCladogram=this.state.Cladogram}},{key:"componentDidUpdate",value:function(){!0===this.state.receivedData&&(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.init()),this.DisplayIndex&&(this.DisplayIndex=!this.DisplayIndex,this.utils.circles=[]),this.utils.tallestTreeScale=this.state.RelScaling,this.utils.useCladogram=this.state.Cladogram}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("canvas",{ref:"canvas",width:window.innerWidth,height:.8*window.innerHeight}),i.a.createElement(b,{initial:0,max:this.state.treeVec.length,formatFn:function(e){return e.toFixed(2)},onChange:function(t){return e.slideToNextTree(t)}}),i.a.createElement("div",{className:"display-save-group"},i.a.createElement("button",{className:"display-btn",onClick:this.toggleIndexDisplay},this.DisplayIndex?"Hide Node ID":"Display Node ID"),"\xa0\xa0",i.a.createElement("button",{className:"save-btn",onClick:this.saveAsPDF},"Save as PDF"),"\xa0\xa0",i.a.createElement("button",{onClick:this.props.refresh},"Refresh")))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return{receivedData:e.received,treeVec:e.trees,RelScaling:e.relscal,Cladogram:e.clado}}}]),t}(i.a.Component),S=function(e){var t=e.type,a=void 0===t?"checkbox":t,n=e.text,r=e.checked,l=e.onChange;return i.a.createElement("label",{className:"check-label"},i.a.createElement("input",{type:a,checked:r,onChange:l}),i.a.createElement("span",{className:"checkmark"}),i.a.createElement("span",{className:"check-custom"},n))},I=function(e){function t(){var e;return Object(s.a)(this,t),(e=Object(h.a)(this,Object(o.a)(t).call(this))).handleUpload=function(t){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var a=new FileReader,n=document.querySelector("input[type=file]").files[0],i=Object(d.a)(e);n&&(n.type.match(/text.*/)&&!n.type.match(/text\/javascript/)?(a.onload=function(e){i.varifyInputFile(e.target.result.split("\n"))?i.setState({trees:e.target.result.split("\n"),uploaded:!0}):(console.log("bad input"),i.forceUpdate())},e.CurrFile=n,a.readAsText(n)):alert("Upload was not a .txt file"))}else alert("Your browswer is too old for HTML5 file uploads. Please update.")},e.handleRefresh=function(){if(null!==e.CurrFile){var t=new FileReader,a=Object(d.a)(e);t.onload=function(e){a.varifyInputFile(e.target.result.split("\n"))?a.setState({trees:e.target.result.split("\n"),uploaded:!0}):a.forceUpdate()},t.readAsText(e.CurrFile)}},e.handleRelScalingChange=function(t){e.setState({RelScaling:t.target.checked})},e.handleCladogramChange=function(t){e.setState({Cladogram:t.target.checked})},e.varifyInputFile=function(e){for(var t="",a=!1,n=0;n<e.length-1;n++){var i=e[n].replace(/(\s[#]\d+\.\d+)/g,"");i.match(/(\()/g).length!==i.match(/(\))/g).length&&(t+="Mismatch parenthesis at line ".concat(n+1,"\n"),a=!0),i.match(/(?=\D)(\w+)/g).length!==i.match(/,/g).length+1&&(t+="Incorrect tree depth at line ".concat(n+1,"\n"),a=!0),i.match(/(?=\D)(\w+)/g).length!==i.match(/(?=\D)(\w+)(\:\s\d+\.\d+)/g).length&&(t+="Mismatch number of species and brlength at line ".concat(n+1,"\n"),a=!0)}return!a||(alert(t),!1)},e.state={uploaded:!1,trees:[],RelScaling:!0,Cladogram:!1},e.CurrFile=null,e.currFileLength=0,e.previousFileLen=0,e}return Object(g.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{style:{marginLeft:30,marginTop:15,marginRight:30}},i.a.createElement(E,{received:this.state.uploaded,trees:this.state.trees,clado:this.state.Cladogram,relscal:this.state.RelScaling,refresh:this.handleRefresh}),i.a.createElement("label",{className:"file-inp"},i.a.createElement("input",{type:"file",onChange:this.handleUpload})),i.a.createElement("div",{className:"scaling-btn-group"},i.a.createElement(S,{text:"Relative Scaling",onChange:this.handleRelScalingChange,checked:this.state.RelScaling}),"\xa0\xa0\xa0\xa0\xa0",i.a.createElement(S,{text:"Cladogram",onChange:this.handleCladogramChange,checked:this.state.Cladogram})))}}]),t}(i.a.Component);var D=function(){return i.a.createElement(I,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[18,1,2]]]);
//# sourceMappingURL=main.1b40873d.chunk.js.map